import{b as _,a as d,d as p,e as f,E as g,P as t,K as h,_ as k,q as v,w}from"./q-cea67d7a.js";import{gtag_report_conversion as x}from"./q-8e936292.js";import{l as C}from"./q-ff582f48.js";import{a as I}from"./q-46496603.js";import{C as P}from"./q-85815eba.js";import{C as S}from"./q-56a62043.js";import{S as q}from"./q-21d7061a.js";import{U as E}from"./q-d713e633.js";import{a as j}from"./q-97996d90.js";const L=async()=>{var l,a;const[e,o,s,r,n]=_();try{(!e.cart||((a=(l=e.cart)==null?void 0:l.products)==null?void 0:a.length)===0)&&(window.location.href="/cart"),r.value=e.cart.shipping;const c=await C("pk_test_51JQBoNENS3vWhi4PIxo7LXkFSn5B92YBONVII3ZNsq2s2lFuBxQ2RZYIIxLHNht8MCd748WSpm0IeL3CeJip9uqx00AlZNkc6H");e.cart.shipping=r.value,e.cart.currencyObject=o,e.cart.user=n,e.cart.products=e.cart.products.filter(b=>b.quantity>0);const i=await I("/api/stripe/",e.cart),{clientSecret:u,sessionId:m}=await i.json();(await c.initEmbeddedCheckout({clientSecret:u,onComplete:async()=>{x(m),localStorage.removeItem("copon"),window.location.href=`/api/stripe?session_id=${m}&userId=${e.cart.userId}&currency=${o}&shipping=${r.value}&isGuest=${n.isDummy}`}})).mount("#checkout"),s.value=!1}catch(c){console.log(c)}},O=({track:e,cleanup:o})=>{const[s]=_();if(e(()=>s.value),s.value!==""){const r=setTimeout(()=>{s.value=""},1e4);o(()=>clearTimeout(r))}},T=()=>{const e=d(P),o=p(0),s=d(S),r=s==null?void 0:s.cur,n=d(E),l=p(!0),a=p(),i=j().url.searchParams.get("error"),u=p(i??"");return f(v(()=>Promise.resolve().then(()=>y),"s_qTCQQty7ois",[e,r,l,o,n])),f(v(()=>Promise.resolve().then(()=>y),"s_RpV0tYgsMIc",[u])),g(k,{children:[u.value&&t("div",null,{class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},[t("strong",null,{class:"font-bold"},"Error! ",3,null),t("span",null,{class:"block sm:inline"},i==="payment-failed"?"Payment failed. Please try again.":"An error occurred. Please try again.",1,null)],1,"En_0"),t("div",null,{class:"flex flex-col gap-5 md:p-10 justify-center items-center"},[g(q,{pageType:"payment",[h]:{pageType:h}},3,"En_1"),l.value&&t("div",null,{class:"flex flex-col gap-4 w-52"},[t("div",null,{class:"skeleton h-32 w-full"},null,3,null),t("div",null,{class:"skeleton h-4 w-28"},null,3,null),t("div",null,{class:"skeleton h-4 w-full"},null,3,null),t("div",null,{class:"skeleton h-4 w-full"},null,3,null)],3,"En_2")],1,null),t("div",{ref:a},{class:"checkout pb-6",id:"checkout"},null,3,null)]},1,"En_3")},y=Object.freeze(Object.defineProperty({__proto__:null,_hW:w,s_6FbPJqb8C5g:T,s_RpV0tYgsMIc:O,s_qTCQQty7ois:L},Symbol.toStringTag,{value:"Module"}));export{w as _hW,T as s_6FbPJqb8C5g,O as s_RpV0tYgsMIc,L as s_qTCQQty7ois};
